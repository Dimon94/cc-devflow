# Definition of Done (DoD)

## 概述
Definition of Done (DoD) 定义了一个任务或需求完成时必须满足的标准。这些标准确保交付的代码具有高质量、可维护性和安全性。

## 通用 DoD 检查清单

### 代码质量
- [ ] **类型检查通过**: TypeScript/类型检查无错误
- [ ] **代码审查通过**: 至少一人审查并批准
- [ ] **代码规范遵循**: 通过 linter 检查，符合团队编码规范
- [ ] **无代码重复**: 重复代码已重构或有充分理由保留
- [ ] **命名规范**: 变量、函数、类名符合项目约定
- [ ] **注释完整**: 复杂逻辑有适当注释，API 有文档注释

### 测试要求
- [ ] **单元测试**: 新增代码有对应单元测试
- [ ] **测试覆盖率**: 单元测试覆盖率 ≥ 80%
- [ ] **集成测试**: 关键业务流程有集成测试
- [ ] **端到端测试**: 用户关键路径有 E2E 测试覆盖
- [ ] **测试通过**: 所有相关测试执行通过
- [ ] **边界测试**: 边界条件和异常情况有测试覆盖

### 安全要求
- [ ] **安全扫描**: 静态安全扫描通过，无高危/中危漏洞
- [ ] **输入验证**: 所有用户输入都有适当验证和清理
- [ ] **敏感数据**: 敏感信息不在代码中硬编码
- [ ] **权限控制**: 适当的身份验证和授权检查
- [ ] **依赖安全**: 第三方依赖无已知高危漏洞

### 性能要求
- [ ] **响应时间**: API 响应时间符合 SLA 要求
- [ ] **资源使用**: CPU/内存使用在合理范围内
- [ ] **数据库**: 数据库查询已优化，有适当索引
- [ ] **缓存策略**: 适当使用缓存提升性能

### 文档要求
- [ ] **API 文档**: 新增/修改的 API 有完整文档
- [ ] **用户文档**: 面向用户的功能有使用说明
- [ ] **CHANGELOG**: 变更记录在 CHANGELOG.md 中
- [ ] **README 更新**: 如有必要，更新 README.md

### 部署要求
- [ ] **环境配置**: 所需环境变量和配置已文档化
- [ ] **数据库迁移**: 数据库变更有迁移脚本
- [ ] **回滚计划**: 有明确的回滚策略和步骤
- [ ] **监控告警**: 关键指标有监控和告警设置

## 特定类型任务的额外要求

### 前端开发
- [ ] **浏览器兼容性**: 在支持的浏览器中测试通过
- [ ] **响应式设计**: 在不同屏幕尺寸下正常显示
- [ ] **可访问性**: 符合 WCAG 2.1 AA 标准
- [ ] **性能优化**: 首屏加载时间 < 3s

### 后端开发
- [ ] **错误处理**: 完善的错误处理和日志记录
- [ ] **API 契约**: API 契约测试通过
- [ ] **并发安全**: 多线程/并发场景下运行正常
- [ ] **数据一致性**: 数据操作保证 ACID 特性

### 数据库变更
- [ ] **备份策略**: 有数据备份和恢复机制
- [ ] **迁移测试**: 迁移脚本在测试环境验证
- [ ] **性能影响**: 评估对现有查询性能的影响
- [ ] **索引优化**: 新增适当索引，删除无用索引

### 配置变更
- [ ] **环境同步**: 所有环境配置保持一致
- [ ] **敏感信息**: 敏感配置信息加密存储
- [ ] **回滚测试**: 配置回滚机制已验证
- [ ] **影响评估**: 配置变更影响范围已评估

## 验收流程

### 开发阶段
1. **自检**: 开发者完成所有 DoD 项目的自检
2. **本地测试**: 在本地环境完整测试功能
3. **提交代码**: 提交到 feature 分支

### 代码审查阶段
1. **静态检查**: 自动化工具检查代码质量
2. **人工审查**: 至少一位团队成员进行代码审查
3. **修改完善**: 根据审查意见修改代码

### 测试阶段
1. **单元测试**: qa-tester 子代理验证测试覆盖率
2. **集成测试**: 在测试环境执行集成测试
3. **安全测试**: security-reviewer 子代理执行安全扫描

### 发布阶段
1. **预发布验证**: 在预发布环境最终验证
2. **发布准备**: 确认所有发布清单项目
3. **正式发布**: 发布到生产环境

## 质量闸控制

### 自动化检查
以下检查由钩子脚本自动执行，不通过则阻止提交/合并：
- TypeScript 类型检查
- 单元测试执行
- 代码规范检查
- 安全扫描
- 构建验证

### 手动检查
以下检查需要人工确认：
- 代码审查质量
- 功能完整性验证
- 用户体验检查
- 文档完整性

## 例外情况

### 紧急修复
对于生产环境紧急修复，可以简化 DoD 要求：
- [ ] **核心功能**: 修复功能正常工作
- [ ] **基础测试**: 至少有基本测试覆盖
- [ ] **安全检查**: 无安全风险
- [ ] **回滚计划**: 有明确回滚方案

### 技术债务
技术债务相关任务的特殊要求：
- [ ] **影响评估**: 技术债务的影响范围已评估
- [ ] **优先级**: 技术债务处理优先级已确定
- [ ] **时间规划**: 有明确的处理时间计划

## DoD 检查工具

### 自动化工具
- **pre-push-guard.sh**: 推送前质量闸检查
- **qa-tester**: 测试覆盖率和质量检查
- **security-reviewer**: 安全扫描和漏洞检测

### 手动检查清单
每个 PR 必须包含 DoD 检查确认：
```markdown
## DoD 检查清单
- [ ] 代码质量标准已满足
- [ ] 测试要求已完成
- [ ] 安全要求已验证
- [ ] 性能要求已满足
- [ ] 文档要求已完成
- [ ] 部署要求已准备
```

## 持续改进

### DoD 更新
DoD 标准会根据项目发展定期更新：
- 每季度评估 DoD 的有效性
- 根据团队反馈调整要求
- 增加新的质量要求
- 简化过于繁琐的流程

### 指标监控
跟踪 DoD 执行效果：
- 缺陷逃逸率
- 代码审查发现问题数量
- 测试覆盖率趋势
- 安全漏洞数量

---

**注意**: DoD 是质量保证的基础，不是可选项。所有团队成员都有责任确保交付的代码满足 DoD 要求。