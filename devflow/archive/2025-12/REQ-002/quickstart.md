# Quickstart Guide: REQ-002 - /flow-checklist

**Version**: 1.0.0
**Created**: 2025-12-15T23:55:00+08:00
**Status**: Draft

---

## 1. Overview

`/flow-checklist` 命令实现 **"Unit Tests for English"** 理念 - 对需求文档进行质量测试。

**核心功能**:
1. 生成需求质量检查清单 (6 种类型)
2. 计算完成度并可视化
3. 作为 /flow-epic 入口门禁 (80% 阈值)

---

## 2. Prerequisites

### 2.1 Environment

```bash
# Required
- Node.js 18+
- Bash 5.x
- jq 1.6+

# Claude API (for checklist generation)
export CLAUDE_API_KEY="sk-ant-..."
```

### 2.2 Workflow Position

```
/flow-init → /flow-clarify → /flow-prd → /flow-checklist → /flow-epic
                                              ↑
                                          YOU ARE HERE
```

### 2.3 Required Files

Before running `/flow-checklist`:
- `PRD.md` must exist (generated by /flow-prd)
- `orchestration_status.json` must show `prd_complete: true`

---

## 3. Quick Start

### 3.1 Generate Checklist

```bash
# Generate single type
/flow-checklist --type ux

# Generate multiple types
/flow-checklist --type ux,api,security

# Generate default (general)
/flow-checklist
```

### 3.2 Check Completion Status

```bash
/flow-checklist --status
```

**Output**:
```
| Checklist | Complete | Total | Percentage |
|-----------|----------|-------|------------|
| ux.md     | 16       | 20    | 80%        |
| OVERALL   | 16       | 20    | 80%        |

Gate Threshold: 80%
Status: ✅ PASS
```

### 3.3 Mark Items Complete

**Manual (recommended)**:
1. Open `checklists/ux.md` in your editor
2. Change `- [ ]` to `- [x]` for completed items
3. Save file

**Command line**:
```bash
# Mark specific items
/flow-checklist --mark CHK001,CHK002,CHK003

# Mark all items in a file
/flow-checklist --mark-all --file ux.md
```

### 3.4 Continue to Epic

```bash
# If completion >= 80%
/flow-epic

# If completion < 80% (emergency skip)
/flow-epic --skip-gate --reason "紧急发布"
```

---

## 4. Checklist Types

| Type | Focus | Use When |
|------|-------|----------|
| `ux` | UI/UX requirements | PRD has user interface needs |
| `api` | API endpoints, contracts | PRD defines backend APIs |
| `security` | Auth, data protection | PRD has security requirements |
| `performance` | Response time, scalability | PRD has performance targets |
| `data` | Data models, validation | PRD defines data structures |
| `general` | Overall requirement quality | Default, catch-all |

**Example**:
```bash
# For a frontend feature
/flow-checklist --type ux,performance

# For a backend API feature
/flow-checklist --type api,security,data

# For a full-stack feature
/flow-checklist --type ux,api,security,performance,data
```

---

## 5. Understanding Checklist Items

### 5.1 Item Format

```markdown
- [ ] CHK001 - Are all UX requirements documented? [Completeness, Spec §FR-1]
      │    │                  │                              │           │
      │    │                  │                              │           └── Reference
      │    │                  │                              └── Quality Dimension
      │    │                  └── Quality Question
      │    └── Item ID (CHK + 3 digits)
      └── Checkbox (unchecked)
```

### 5.2 Quality Dimensions

| Dimension | What It Tests | Example Question |
|-----------|--------------|------------------|
| `Completeness` | Are all requirements present? | "Are error states defined?" |
| `Clarity` | Are requirements specific? | "Is 'fast' quantified?" |
| `Consistency` | Do requirements align? | "Are field names consistent?" |
| `Measurability` | Can we verify objectively? | "Can 'user-friendly' be measured?" |
| `Coverage` | Are all scenarios addressed? | "Are edge cases defined?" |

### 5.3 References

| Reference | Meaning |
|-----------|---------|
| `[Spec §FR-XXX]` | Links to PRD functional requirement |
| `[Spec §NFR-XXX]` | Links to non-functional requirement |
| `[Gap]` | Missing requirement identified |
| `[Ambiguity]` | Unclear requirement needs clarification |

---

## 6. Completion Workflow

### 6.1 Review Process

1. **Read each item** - Understand what it's asking about requirements
2. **Check PRD.md** - Is this requirement defined/clear/complete?
3. **Mark appropriately**:
   - `[x]` if requirement is well-defined
   - `[ ]` if requirement needs improvement
4. **Take action** on unchecked items:
   - Update PRD.md to address the gap
   - Or document as intentional scope exclusion

### 6.2 Example Review

**Checklist Item**:
```markdown
- [ ] CHK005 - Is 'fast response' quantified with specific timing? [Clarity, Spec §NFR-1]
```

**Review**:
1. Check PRD.md for "fast response" or "response time"
2. Found: "The system should respond quickly"
3. Action: Update PRD to "The system should respond within 500ms (p95)"
4. Mark as complete: `- [x] CHK005 - ...`

---

## 7. Configuration

### 7.1 Threshold Adjustment

Edit `config/quality-rules.yml`:
```yaml
gate:
  threshold: 70  # Lower to 70% if needed
```

### 7.2 Type Customization

```yaml
types:
  ux:
    min_items: 10  # Reduce minimum items
    max_items: 20  # Reduce maximum items
```

---

## 8. Troubleshooting

### 8.1 Common Errors

| Error | Cause | Solution |
|-------|-------|----------|
| `MISSING_PRD` | No PRD.md file | Run `/flow-prd` first |
| `INVALID_TYPE` | Unknown type specified | Use valid types: ux, api, security, performance, data, general |
| `NO_CHECKLISTS` | No checklists generated | Run `/flow-checklist --type <type>` |
| `GATE_FAILED` | Completion < 80% | Complete more items or use --skip-gate |

### 8.2 API Timeout

If checklist generation times out:
```bash
# Retry the command
/flow-checklist --type ux

# Or generate types one at a time
/flow-checklist --type ux
/flow-checklist --type api
```

### 8.3 Parse Errors

If checkbox parsing fails:
1. Ensure format is exactly `- [ ]` or `- [x]`
2. Check for extra spaces or characters
3. Use lowercase `x` (uppercase `X` also works)

---

## 9. Testing Commands

### 9.1 Validate Checklist Format

```bash
# Check if checklist is valid
grep -E "^- \[[ xX]\] CHK[0-9]{3}" checklists/ux.md

# Count total items
grep -c "^- \[" checklists/ux.md

# Count completed items
grep -c "^- \[[xX]\]" checklists/ux.md
```

### 9.2 Test Gate Hook

```bash
# Test gate with JSON output
node .claude/hooks/checklist-gate.js --req-id REQ-002 --json

# Test skip functionality
node .claude/hooks/checklist-gate.js --req-id REQ-002 --skip --reason "test"
```

---

## 10. File Locations

| File | Path | Purpose |
|------|------|---------|
| Command | `.claude/commands/flow-checklist.md` | Command definition |
| Agent | `.claude/agents/checklist-agent.md` | Generation logic |
| Hook | `.claude/hooks/checklist-gate.js` | Gate check |
| Config | `config/quality-rules.yml` | Threshold settings |
| Template | `.claude/docs/templates/CHECKLIST_TEMPLATE.md` | Output format |
| Checklists | `devflow/requirements/{REQ}/checklists/` | Generated files |

---

## 11. Related Commands

| Command | Relationship |
|---------|--------------|
| `/flow-prd` | **Before**: Generates PRD.md input |
| `/flow-epic` | **After**: Uses checklist gate |
| `/flow-status` | Shows checklist completion in status |

---

**Generated by**: tech-architect agent
**Version**: 1.0.0
